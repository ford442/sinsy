<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sinsy</title>
  </head>
  <body>
    <button id="run-button" disabled>Synthesize</button>
    <div id="output"></div>
    <script>
      const runButton = document.getElementById('run-button');
      const outputElement = document.getElementById('output');

      var Module = {
        onRuntimeInitialized: function() {
          console.log('Sinsy loaded');
          runButton.disabled = false;
        },
        print: function(text) {
          console.log(text);
        },
        printErr: function(text) {
          console.error(text);
        }
      };
runButton.addEventListener('click', () => {
        const args = [
          // REMOVED: '/sinsy.js', 
          '-x', '/dic',
          '-m', '/voices/nitech_jp_song070_f001.htsvoice',
          '-o', 'output.wav',
          '/scores/Ave_Maria_D839_-_Schubert_-_Solo_Piano_Arrg..mxl'
        ];
        
        // It is good practice to check the return value (0 = success)
        const returnCode = Module.callMain(args);

        if (returnCode === 0) {
            try {
              const wavData = Module.FS.readFile('output.wav');
              const blob = new Blob([wavData], { type: 'audio/wav' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'output.wav';
              a.textContent = 'Download output.wav';
              outputElement.innerHTML = '';
              outputElement.appendChild(a);
            } catch (e) {
              console.error(e);
              outputElement.textContent = 'Error reading output file.';
            }
        } else {
            outputElement.textContent = 'Synthesis failed. Check console for details.';
        }
      });
    </script>
    <script src="sinsy.js"></script>
  </body>
</html>
