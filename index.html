<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sinsy</title>
  </head>
  <body>
    <button id="run-button" disabled>Synthesize</button>
    <div id="output"></div>
    <script>
      const runButton = document.getElementById('run-button');
      const outputElement = document.getElementById('output');

      var Module = {
        onRuntimeInitialized: function() {
          console.log('Sinsy loaded');
          runButton.disabled = false;
        },
        print: function(text) {
          console.log(text);
        },
        printErr: function(text) {
          console.error(text);
        }
      };

      runButton.addEventListener('click', () => {
        const args = [
          '/sinsy.js',
          '-x', '/dic',
          '-m', '/voices/nitech_jp_song070_f001.htsvoice',
          '-o', 'output.wav',
          '/scores/Ave_Maria_D839_-_Schubert_-_Solo_Piano_Arrg..mxl'
        ];
        
        Module.callMain(args);

        // Create a download link for the output file
        try {
          const wavData = Module.FS.readFile('output.wav');
          const blob = new Blob([wavData], { type: 'audio/wav' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'output.wav';
          a.textContent = 'Download output.wav';
          outputElement.innerHTML = '';
          outputElement.appendChild(a);
        } catch (e) {
          console.error(e);
          outputElement.textContent = 'Error creating download link. See console for details.';
        }
      });
    </script>
    <script src="sinsy.js"></script>
  </body>
</html>
